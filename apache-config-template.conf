# Apache Virtual Host Configuration for Event Manager
# Place this file in /etc/apache2/sites-available/event-manager.conf

<VirtualHost *:80>
    ServerName event-manager.local
    DocumentRoot /opt/event-manager/event-manager-frontend/dist
    
    # Proxy API requests to Node.js
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    
    # Proxy WebSocket connections
    ProxyPass /socket.io/ ws://localhost:3000/socket.io/
    ProxyPassReverse /socket.io/ ws://localhost:3000/socket.io/
    
    # Serve static files
    <Directory /opt/event-manager/event-manager-frontend/dist>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Handle SPA routing
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Serve uploads
    Alias /uploads /opt/event-manager/uploads
    <Directory /opt/event-manager/uploads>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/event-manager_error.log
    CustomLog ${APACHE_LOG_DIR}/event-manager_access.log combined
</VirtualHost>

# SSL Configuration (uncomment and configure for HTTPS)
# <VirtualHost *:443>
#     ServerName event-manager.local
#     DocumentRoot /opt/event-manager/event-manager-frontend/dist
#     
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/event-manager.crt
#     SSLCertificateKeyFile /etc/ssl/private/event-manager.key
#     
#     # Same configuration as HTTP virtual host
#     ProxyPreserveHost On
#     ProxyPass /api/ http://localhost:3000/api/
#     ProxyPassReverse /api/ http://localhost:3000/api/
#     
#     ProxyPass /socket.io/ ws://localhost:3000/socket.io/
#     ProxyPassReverse /socket.io/ ws://localhost:3000/socket.io/
#     
#     <Directory /opt/event-manager/event-manager-frontend/dist>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         RewriteEngine On
#         RewriteBase /
#         RewriteRule ^index\.html$ - [L]
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule . /index.html [L]
#     </Directory>
#     
#     Alias /uploads /opt/event-manager/uploads
#     <Directory /opt/event-manager/uploads>
#         Options Indexes FollowSymLinks
#         AllowOverride None
#         Require all granted
#     </Directory>
#     
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set Referrer-Policy "no-referrer-when-downgrade"
#     
#     ErrorLog ${APACHE_LOG_DIR}/event-manager_ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/event-manager_ssl_access.log combined
# </VirtualHost>
